
https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2012-0781

http://svn.php.net/viewvc?view=revision&revision=319254

--- php-5.3.3/ext/tidy/tidy.c.cve0781
+++ php-5.3.3/ext/tidy/tidy.c
@@ -1278,7 +1278,7 @@ static PHP_FUNCTION(tidy_diagnose)
 {
 	TIDY_FETCH_OBJECT;
 
-	if (tidyRunDiagnostics(obj->ptdoc->doc) >= 0) {
+	if (tidyStatus(obj->ptdoc->doc) != 0 && tidyRunDiagnostics(obj->ptdoc->doc) >= 0) {
 		tidy_doc_update_properties(obj TSRMLS_CC);
 		RETURN_TRUE;
 	}
