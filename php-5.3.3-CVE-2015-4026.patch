Adapted for PHP 5.3.3 from


From be9b2a95adb504abd5acdc092d770444ad6f6854 Mon Sep 17 00:00:00 2001
From: Stanislav Malyshev <stas@php.net>
Date: Sat, 9 May 2015 23:13:06 -0700
Subject: [PATCH] Fixed bug #69418 - more s->p fixes for filenames

diff -up php-5.3.3/ext/pcntl/pcntl.c.cve4026 php-5.3.3/ext/pcntl/pcntl.c
--- php-5.3.3/ext/pcntl/pcntl.c.cve4026	2015-06-05 12:50:43.191612754 +0200
+++ php-5.3.3/ext/pcntl/pcntl.c	2015-06-05 12:51:32.972995507 +0200
@@ -672,6 +672,9 @@ PHP_FUNCTION(pcntl_exec)
 	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|aa", &path, &path_len, &args, &envs) == FAILURE) {
 		return;
 	}
+	if (strlen(path) != path_len) {
+		return;
+	}
 	
 	if (ZEND_NUM_ARGS() > 1) {
 		/* Build argumnent list */
diff -up php-5.3.3/ext/standard/basic_functions.c.cve4026 php-5.3.3/ext/standard/basic_functions.c
--- php-5.3.3/ext/standard/basic_functions.c.cve4026	2015-06-05 12:51:55.911171871 +0200
+++ php-5.3.3/ext/standard/basic_functions.c	2015-06-05 12:52:30.160435199 +0200
@@ -5474,6 +5474,9 @@ PHP_FUNCTION(set_include_path)
 	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s", &new_value, &new_value_len) == FAILURE) {
 		return;
 	}
+	if (strlen(new_value) != new_value_len) {
+		return;
+	}
 
 	/* No nulls allowed in paths */
 	if (strlen(new_value) != new_value_len) {
diff -up php-5.3.3/ext/standard/dir.c.cve4026 php-5.3.3/ext/standard/dir.c
--- php-5.3.3/ext/standard/dir.c.cve4026	2015-06-05 12:53:04.325697880 +0200
+++ php-5.3.3/ext/standard/dir.c	2015-06-05 12:54:40.474437133 +0200
@@ -218,6 +218,9 @@ static void _php_do_opendir(INTERNAL_FUN
 	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|r", &dirname, &dir_len, &zcontext) == FAILURE) {
 		RETURN_NULL();
 	}
+	if (strlen(dirname) != dir_len) {
+		RETURN_NULL();
+	}
 
 	context = php_stream_context_from_zval(zcontext, 0);
 	
@@ -293,6 +296,9 @@ PHP_FUNCTION(chroot)
 	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s", &str, &str_len) == FAILURE) {
 		RETURN_FALSE;
 	}
+	if (strlen(str) != str_len) {
+		RETURN_FALSE;
+	}
 	
 	ret = chroot(str);
 	if (ret != 0) {
